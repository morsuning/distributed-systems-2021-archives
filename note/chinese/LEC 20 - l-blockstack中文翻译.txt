6.824 2021 第20讲：Blockstack (2016)

今天的主题：去中心化应用
- 以将数据所有权转移到用户手中并脱离集中控制的网站的方式构建应用
  - 网站的完全不同架构，某天可能更好
- 有许多最近（和更早）对这个一般愿景的探索。
  - 早期P2P应用、keybase、solid等
- 比特币的成功（和特性）最近引起了很多活动
  - 区块链的非加密货币用途
- Blockstack是一个真实系统，由一家公司开发
  - 它确实有一些用户和一些为其编写的应用
  - 关键挑战：命名

旧式：典型的（集中式）网站
- [用户浏览器、网络、具有应用代码的网站服务器、网站的数据库]
- 用户数据隐藏在专有应用代码后面
- 例如博客文章、gmail、piazza、reddit评论、照片分享、
  日历、医疗记录等
- 这种安排非常成功
  - 易于编程
- 为什么这不理想？
  - 如果用户想看到他们的数据，必须使用这个网站的UI
  - 网站设定（和更改！）谁获得访问的规则
  - 网站可能窥探，向广告商出售信息
  - 网站的员工可能因个人原因窥探
  - 令人失望，因为通常这是用户自己的数据！
- 问题的一个设计观点：
  - 大的接口划分在用户和应用+数据之间
  - 应用+数据集成对网站所有者方便
  - 但HTML作为接口是面向UI的。
    - 并且通常在给用户控制和访问数据方面不够好

新式：去中心化应用
- [用户应用、通用云存储服务、命名/PKI]
- 这种架构将应用代码与用户数据分离
  - 大的接口划分在用户+应用和数据之间
  - 所以有更清晰的用户的数据库念，由用户拥有/控制
  - 就像你拥有笔记本电脑上或Athena账户中的数据
- 存储系统的要求
  - 在云端，所以可以从任何设备访问
  - 通用，像文件系统
  - 由拥有数据的用户支付和控制
  - 用户之间的共享，根据权限，对于多用户应用
  - 用户应用之间的共享，根据权限
  - 类似现有服务如Amazon S3

有什么意义？
- 用户更容易切换应用，因为数据不与应用（或网站）绑定
- 更容易有查看多种数据的应用
  - 日历/电子邮件，或备份，或文件浏览器
- 隐私vs窥探（假设端到端加密）

去中心化应用可能如何工作？
- 这里是一个简单的可能性。
- 应用：由两个用户共享的待办事项列表
  - [UI x2，复选框列表，"添加"按钮]
- 两者都贡献要完成的条目
- 两者都可以将一个条目标记为完成
- 一个公共存储系统，
  - 由U1和U2各自拥有的键/值数据
- 用户U1和U2在他们的计算机上运行应用
  - 也许作为浏览器中的JavaScript
  - 应用读取其他用户的公共数据，写入自己用户的数据
- 应用没有任何相关服务器，它只使用存储系统
- 每个用户创建包含待办事项的文件
  - 和包含"完成"标记的文件
- 每个用户的UI代码定期扫描其他用户的待办文件
- 要点：
  - 服务是存储，独立于任何应用。
  - 所以用户可以切换应用，编写自己的，添加加密以
    防止窥探，删除他们的待办列表，备份它们，
    与电子邮件应用集成等

可能出什么问题？
- 去中心化是痛苦的：
  - 每用户类似文件系统的存储比专用SQL数据库灵活性低得多
  - 没有可信服务器例如在不透露的情况下查看拍卖出价
  - 加密隐私/认证使其他一切都更难
  - 对用户和程序员都很尴尬
- 当前网站架构工作得很好
  - 易于编程
  - 对软件+数据的中央控制使更改（和调试）容易
  - 性能、可靠性的好解决方案
  - 容易强加应用特定的安全性
  - 成功的收入模式（广告）

现在谈谈Blockstack

为什么Blockstack专注于命名？
- 名称对应于人类用户，例如"robertmorris"
- 名称 -> 用户数据的位置（在Gaia中），所以多个用户可以交互
- 名称 -> 公钥，用于端到端数据安全
  - 所以我可以检查我真的检索到你的真实数据
  - 所以我可以加密我的数据以便只有你能解密它
  - 因为存储系统不可信
- 缺乏好的全局PKI已经损害了许多其他方面好的安全思想
  - 所以Blockstack从名称开始

Blockstack声称命名困难，由"Zoko三角"总结：
1. 唯一（全局）即每个名称对每个人都有相同的含义
2. 人类可读
3. 去中心化
- 声称：所有三个都有价值（可辩论...）
- 声称：任意两个容易；所有三个困难

每对属性的例子？
- 唯一 + 人类可读：电子邮件地址
- 唯一 + 去中心化：随机选择的公钥
- 人类可读 + 去中心化：我的联系人列表

为什么所有三个困难？
- 我们可以为我们的三个方案中的任何一个添加缺失的属性吗？
- 不，所有似乎都是立即的死胡同

Blockstack如何获得所有三个的总结？
- 比特币产生有序的块链
- Blockstack在比特币块中嵌入名称声明记录
- 如果我声明"rtm"的记录在比特币链中是第一个，我拥有它
- 唯一（==全局相同）？
- 人类可读？
- 去中心化？

这种命名空间对去中心化应用好吗？
- 唯一（==全局）有价值吗？
  - 是的：我可能能够记住我已经知道的名称。
  - 是的：我可以给你一个名称，你可以使用它。
  - 是的：我可以查看ACL并猜测它是什么意思。
  - 不：如果从全局池中选择，人类可读的名称不太可能非常有意义
    - 例如robert_morris_1779 -- 那是我吗？还是别人？
    - "rtm@mit.edu"怎么样？
  - 不：我怎么找到你的Blockname名称？
    - 我如何验证Blockstack名称真的是你？
- 其他（可能坏的）想法：
  - 只有公钥，不费心人类可读名称
    - 每个人保留他们理解的名称的单独"联系人列表"
    - 自然去中心化
    - 不是"唯一的"因此不需要比特币
  - 可靠验证人类身份的中央实体

挑战：利用现有区块链
- 启动新区块链很困难
  - 需要足够大以处理拜占庭参与者
- 比特币区块链
  - 记录中数据的限制
  - 慢写入
  - 块大小
  - 账本

Blockstack中的所有部分是什么？
- 客户端、浏览器、应用、blockstack.js
- Blockstack浏览器（ meant在客户端机器上运行）
- 比特币区块链
- Blockstack服务器
  - 读取比特币链
  - 解释Blockstack命名记录以更新数据库
  - 服务来自客户端的命名RPC
  - 名称 -> 公钥 + 区域哈希
- Atlas服务器 -- 存储"区域记录"
  - 比特币中的名称记录映射到Atlas中的区域记录
  - 区域记录指示我的Gaia数据存储在哪里
  - 由内容哈希键控，所以条目不可变
  - 你可以将Atlas视为只是减少Blockstack比特币交易的大小
  - Atlas在每个服务器中保留完整数据库
- Gaia服务器
  - 每个用户的单独存储区域（即最终用户）
  - 键 -> 值
  - 由Amazon S3、Dropbox等支持
    - Gaia使它们看起来都相同
  - 大多数用户使用Blockstack提供的Gaia存储
  - 用户的配置文件包含用户的公钥、每个应用的公钥
  - 用户可以有很多其他文件，包含应用数据
  - 应用可以在Gaia中签名和/或加密数据
- S3、Dropbox等
  - Gaia的后端

名称创建

如何注册Blockstack名称？
- (https://docs.blockstack.org/core/wire-format.html)
- 用户这样做（通过运行Blockstack软件）
- 用户必须拥有一些比特币
- 两个比特币交易：预购，注册
- 预购交易
  - 向"销毁"地址支付注册费
  - hash(name)
- 注册交易
  - 名称（未哈希）
  - 所有者公钥
  - hash(zonefile)
- Blockstack信息隐藏在交易内部，比特币不查看它
  - 但比特币签名/哈希覆盖这个Blockstack信息

为什么*两个*交易？
- 前跑（front-running）

为什么有注册费？毕竟没有真实成本。

如果客户端尝试注册已被占用的名称怎么办？

如果两个客户端同时尝试注册相同名称怎么办？

攻击者有可能更改名称->密钥绑定吗？
- 毕竟，任何人都可以提交他们喜欢的任何比特币交易

Blockstack有可能更改名称->密钥绑定吗？

存储

客户端如何知道从哪里获取数据？
- 从拥有用户的名称和密钥开始
- 应用可能使用众所周知的密钥，例如"配置文件"或"待办列表"
- 比特币/blockstack、hash(zone)、gaia地址

客户端如何检查它从Gaia获得的数据是正确的？

客户端如何知道来自Gaia的数据是新鲜的（最新版本）？
- 所有者在写入时签名了数据
- 其他人可以在哪里获得所有者的公钥以检查签名？

Gaia如何知道是否让客户端写入/更改/删除？

隐私加密呢？
- 如果只有所有者应该看到数据？
- 如果另一个用户除了所有者之外应该看到数据？
- 如果只有6.824学生应该看到数据？

私钥

永远不离开用户的设备
- 所以你不必除了你的设备和Blockstack软件之外信任任何东西
- 你的每个设备都有你的主私钥副本

"主"私钥只有Blockstack浏览器能看到
- 太敏感了，不让应用看到或使用它
- 由密码短语保护，在用户活动时是明文

Blockstack浏览器分发每个应用的私钥
- 所以每个应用或多或少有独立的加密存储
- 使用户的不同应用难以合作
  - 有时这是你想要的
  - 有时你确实想要在自己的应用之间共享

讨论

这里有一些供思考的问题。
- 关于命名
- 关于去中心化应用
你可以将它们视为批评。
或作为进一步发展的领域。

问：blockstack可以用作电子邮件的PKI，将rtm@mit.edu映射到我的公钥吗？
  - blockstack名称vs电子邮件地址？
  - blockstack名称意味着什么？

问：为什么PKI一般困难？
  - 丢失的密码短语和密钥
    - 恢复（母亲的姓氏？SMS？电子邮件？）
  - 名称意味着什么？与"真实"身份的联系？
  - 如何从我想与之交谈的人的直观概念，到名称？
  - 一些进展，例如Keybase

问：对于命名和PKI，去中心化有强烈价值吗？
  - 我们可以有集中化但安全的命名系统吗？
    - 我们可以信任谁为全球范围系统服务？
  - 实际上中央权威能现实地交付什么价值？
  - 采用去中心化会更容易吗？

问：blockstack可以使用类似证书透明度的方案而不是比特币吗？
  - CT不能解决冲突，只能揭示它们。
    - 不同的CT日志可能有不同的顺序
      - 所以CT不能说哪个先来
    - 是比特币挖矿解决分叉并强制同意
  - Blockstack的费用方面vs垃圾邮件等似乎关键，依赖于加密货币
  - 一般来说，开放的区块链只有在有加密货币时才有意义

问：Blockstack对程序员方便吗？
  - 所有代码在客户端，没有特殊服务器
    - 难以有特定于应用的数据，而不是每个用户
    - 索引、投票计数、Reddit或Hacker News的首页排名
  - SQL查询
  - 加密访问控制、组、撤销等
  - 难以既查看其他用户的秘密，又保持秘密
    - 例如对于eBay
  - 也许只有用户热情时才值得...

问：去中心化用户拥有的存储对用户隐私好吗？
  - 比信任Facebook/Google/等网站保持数据私密更好吗？
    - vs其他用户、黑客、他们自己的员工？
  - Blockstack存储提供商可以监视你访问什么吗？
  - 如果应用，在你的计算机上，窥探你怎么办？
    - 毕竟，它可能仍然是Facebook或其他人编写应用。
  - 加密访问控制真的可行吗？
  - 你仍然必须信任提供商保留你的数据
    - 并提供最新版本
    - 如果你那么信任他们，为什么不信任他们也保密？

问：去中心化用户拥有的存储对用户控制好吗？
  - 用户想为相同数据频繁切换应用吗？
  - 用户想在多个应用中使用相同数据吗？
  - 在不同应用格式下，两者都真正可行吗？

问：用户愿意为他们自己的Gaia存储付费吗？

结论

我从Blockstack中得到什么？
- 我觉得整体去中心化愿景有吸引力。
- 整个东西依赖于PKI -- 这里的任何进展都会很棒
  - 所有用户到他们公钥的通用映射将非常有用
- 惊讶的是我们可以有去中心化人类可读名称分配
  - 但不清楚去中心化人类可读名称是否是个好主意
- 将云数据与应用分离听起来是个好主意
  - 但开发者会讨厌它（例如没有SQL）。
  - 不清楚用户会知道或关心。
  - 不清楚用户是否愿意为存储付费。
- 隐私的端到端加密听起来是个好主意
  - 私钥管理是个痛苦，而且脆弱
  - 加密使共享和访问控制非常尴尬
- 你仍然必须信任供应商软件；不清楚它是
  - 在你的笔记本电脑而不是
  - 供应商服务器上运行是一个巨大的胜利。

尽管如此，如果Blockstack或类似的东西
  - 能够成功，那将太棒了。

--- 参考文献 ---

https://dataspace.princeton.edu/handle/88435/dsp019306t191k
https://econinfosec.org/archive/weis2015/papers/WEIS_2015_kalodner.pdf