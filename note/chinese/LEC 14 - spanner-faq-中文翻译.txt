6.824 Spanner常见问题解答

问：什么是时间？

答：2020年4月7日UTC 13:00:00.000是一个时间。时间以每秒一秒的稳定速率前进。

问：什么是时钟？

答：时钟是驱动计数器的振荡器。振荡器应该以稳定的已知速率（例如每秒一个滴答）滴答。计数器最初必须与正确时间源同步；之后，振荡器的滴答导致计数器推进时间。如果振荡器以精确正确的速率滴答，计数器将与正确时间精确同步前进。在现实生活中，振荡器以变化且有些不正确的频率滴答，所以计数器逐渐偏离正确时间。

问：现在几点了？

答：为了提供通用时间（UTC）的概念，一批政府实验室单独维护高精度时钟，并相互比较以产生关于现在是什么时间的共识。当前时间通过多种方式广播，如WWV、GPS和NTP，以便普通人可以知道官方时间。这些广播需要变化且难以预测的时间到达听众，所以你永远不会知道确切的时间。

问：什么是原子钟？

答：高度稳定的振荡器。有两种主要技术被称为"原子钟"：铷钟和铯钟。两者都利用外层电子状态的变化，涉及特定的能量量子和波长。通过观察电子的激发程度，可以将信号发生器精确调谐到该波长。原子钟只是时钟的振荡器部分；启动时，它必须以某种方式与UTC同步，通常通过GPS等无线电广播。

问：Spanner使用什么类型的原子钟？

答：遗憾的是论文没有说明。铷钟通常几千美元（例如https://thinksrs.com/products/fs725.html）。铷钟每周可能偏差几微秒，所以它们需要偶尔重新同步到UTC（通常通过GPS）。铯钟可能需要50,000美元；HP 5071A是一个很好的例子。铯钟不会漂移。当然，任何单个时钟都可能故障或断电，所以即使有完美的铯钟，你仍然需要不止一个和与UTC同步的能力。我的猜测，基于价格，Spanner使用与GPS接收器同步的铷钟。

问：外部一致性如何与线性化和序列化相关？

答：外部一致性似乎等价于线性化，但应用于整个事务而不是单个读和写。外部一致性似乎也等价于严格序列化，这是序列化加上等价序列顺序必须遵循实时顺序的额外约束。关键特性是如果事务T1完成，然后（在实时之后）事务T2开始，T2必须看到T1的写入。

问：为什么外部一致性是可取的？

答：假设哈特谢普苏特通过圣何塞数据中心中的Web服务器更改了她工作组共享的账户密码。她通过隔板墙向同事Cassandra低声说出新密码。Cassandra通过不同数据中心（圣马特奥）中的Web服务器登录该账户。外部一致性保证Cassandra将观察到密码的更改，而不是例如看到陈旧的副本。

问：Spanner可以使用Raft而不是Paxos吗？

答：可以。在这篇论文的层面上没有区别。在Spanner构建时，Raft还不存在，Google已经有了一个调优和可靠的Paxos实现。看看Chandra等人的论文"Paxos Made Live"。

问：Spanner的提交等待的目的是什么？

答：提交等待确保读/写事务不会完成，直到其时间戳中的时间保证已经过去。这意味着在读/写事务完成后开始的只读事务保证有更高的时间戳，从而看到读/写事务的写入。这有助于履行外部一致性的保证：如果T1在T2开始前完成，T2在等价序列顺序中将在T1之后（即T2将看到T1的写入）。

问：有人使用Spanner吗？

答：据说有数百个Google服务依赖Spanner。论文讨论了它在Google广告系统中的使用。Google的Zanzibar授权系统使用Spanner。它以Cloud Spanner的形式向Google云客户提供。CockroachDB开源数据库基于Spanner设计。